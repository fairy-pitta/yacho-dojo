# 野鳥識別士試験 勉強サイト 実装タスク

## 開発ルール（テストドリブン開発）

### 各タスクの実行手順
1. **タスク開始**: tasks.mdの該当タスクを確認
2. **テスト作成**: 機能のテストコードを先に作成
3. **実装**: テストが通るように機能を実装
4. **テスト実行**: `npm test` でテストが全て通ることを確認
5. **タスク完了**: tasks.mdの該当タスクにチェックマーク ✅ を追加
6. **コミット**: `git add . && git commit -m "[タスク名]: [タスクの説明]"` でコミット

### テスト戦略
- **単体テスト**: Jest + React Testing Library
- **統合テスト**: API エンドポイントのテスト
- **E2Eテスト**: Playwright（重要な機能のみ）

---

## Phase 1: 基本機能（MVP）

### 1.1 プロジェクトセットアップ ✅
- [x] Supabase認証付きNext.jsスターターキット使用 <mcreference link="https://vercel.com/templates/authentication/supabase" index="1">1</mcreference>
  - [x] 現在のディレクトリに直接作成: `npx create-next-app --example with-supabase .`
  - [x] 既存ファイルとの競合確認・解決
  - [x] スターターキットの特徴確認:
    - Next.js App Router対応
    - TypeScript + Tailwind CSS設定済み
    - shadcn/ui コンポーネント
    - Cookieベース認証
    - Supabase SSR設定済み
- [x] 追加依存関係のインストール
  - [x] テスト環境セットアップ: `npm install --save-dev jest @testing-library/react @testing-library/jest-dom`
  - [x] E2Eテスト: `npm install --save-dev playwright @playwright/test`
  - [ ] グラフライブラリ（Chart.js, Recharts等）
  - [ ] UI拡張ライブラリ（必要に応じて）
- [x] フォルダ構成の確認・拡張
  - [x] components/ (既存)
  - [x] app/ (App Router、既存)
  - [x] lib/ (既存)
  - [x] types/ (新規作成)
  - [x] utils/ (新規作成)
  - [x] __tests__/ (テスト用ディレクトリ)
  - [x] e2e/ (E2Eテスト用ディレクトリ)
- [x] **テスト実行**: `npm test`
- [x] **コミット**: `git add . && git commit -m "[プロジェクトセットアップ]: テスト環境とプロジェクト構造セットアップ完了"`

### 1.2 Supabase セットアップ ✅
- [x] Supabase プロジェクト作成 <mcreference link="https://supabase.com/docs/guides/getting-started/quickstarts/nextjs" index="4">4</mcreference>
  - [x] dashboard.supabase.com でプロジェクト作成
  - [x] プロジェクト名: yacho-dojo
  - [x] リージョン選択（Asia Pacific推奨）
- [x] 環境変数設定
  - [x] `.env.example` を `.env.local` にリネーム
  - [x] プロジェクトのAPI設定から以下を取得・設定:
    - `NEXT_PUBLIC_SUPABASE_URL`
    - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- [x] スターターキットの認証機能確認・テスト
  - [x] 開発サーバー起動: `npm run dev`
  - [x] 認証フロー動作確認
- [x] カスタムデータベーステーブル作成
  - [x] **テスト作成**: データベーステーブル作成のテスト
  - [x] Users（auth.usersを使用、プロフィール拡張用）
  - [x] Birds テーブル
  - [x] BirdImages テーブル
  - [x] Questions テーブル
  - [x] UserAnswers テーブル
  - [x] Comments テーブル
  - [x] QuestionRatings テーブル
  - [x] CommentRatings テーブル
- [x] RLS（Row Level Security）ポリシー設定
- [x] 外部キー制約設定
- [x] **テスト実行**: `npm test`
- [x] **コミット**: `git add . && git commit -m "[Supabaseセットアップ]: データベーステーブル作成とテスト実装完了"`

### 1.3 クイズデータ作成 ✅
- [x] **テスト作成**: クイズデータ作成・投入のテスト
  - [x] 野鳥データの投入テスト
  - [x] クイズ問題データの投入テスト
  - [x] データ整合性のテスト
- [x] 野鳥データの準備
  - [x] jpbirdlist8ed_ver1.xlsxファイルの解析
  - [x] 野鳥データの抽出・整形
  - [x] Birdsテーブル用データの作成
  - [x] BirdImagesテーブル用データの作成（画像URL等）
- [x] クイズ問題データの作成
  - [x] 野鳥識別問題の作成
  - [x] 選択肢の生成
  - [x] 難易度設定
  - [x] カテゴリ分類
- [x] データベースへの投入
  - [x] SQLインサート文の作成
  - [x] データ投入スクリプトの作成
  - [x] データ投入の実行
- [x] データ検証
  - [x] 投入データの確認
  - [x] データ整合性チェック
  - [x] サンプルクエリでの動作確認
- [x] **テスト実行**: `npm test`
- [x] **コミット**: `git add . && git commit -m "[クイズデータ作成]: 野鳥データとクイズ問題の作成・投入完了"`

### 1.4 認証システム（スターターキット活用） ✅
- [x] **テスト作成**: 認証システムのテスト
  - [x] ログイン/ログアウトのテスト
  - [x] 認証状態管理のテスト
  - [x] 保護されたルートのテスト
- [x] 既存認証機能の確認・カスタマイズ <mcreference link="https://supabase.com/docs/guides/auth/server-side/nextjs" index="2">2</mcreference>
  - [x] ログイン/サインアップページの確認（/login, /signup）
  - [x] 認証フローの動作確認
  - [x] ミドルウェア設定の確認（middleware.ts）
  - [x] Server-Side Auth設定の確認
  - [x] Cookieベース認証の動作確認
- [x] Google OAuth プロバイダー追加設定
  - [x] Supabase Auth設定でGoogle Provider有効化
  - [x] Google Cloud Console設定
  - [x] 認証フロー確認
- [x] ユーザープロフィール管理の拡張
  - [x] プロフィール編集ページ作成
  - [x] アバター画像アップロード機能
  - [x] プロフィール情報の追加フィールド
- [x] 保護されたルートの追加設定
  - [x] クイズページの保護
  - [x] 成績ページの保護
- [x] **テスト実行**: `npm test`
- [x] **コミット**: `git add . && git commit -m "[認証システム]: 認証機能のカスタマイズと拡張"`

### 1.4 基本UI コンポーネント ✅
- [x] **テスト作成**: UIコンポーネントのテスト
  - [x] レイアウトコンポーネントのレンダリングテスト
  - [x] 共通UIコンポーネントのテスト
  - [x] インタラクションのテスト
- [x] レイアウトコンポーネント
  - [x] Header（ナビゲーション、ユーザーメニュー）
  - [x] Footer
  - [x] Sidebar（メニュー）
- [x] 共通UIコンポーネント
  - [x] Button
  - [x] Input
  - [x] Modal
  - [x] Loading Spinner
  - [x] Toast 通知
- [x] **テスト実行**: `npm test`
- [x] **コミット**: `git add . && git commit -m "[基本UI]: レイアウトと共通UIコンポーネント作成"`

### 1.5 ホーム画面 ✅
- [x] **テスト作成**: ホーム画面のテスト
  - [x] ダッシュボード表示のテスト
  - [x] ナビゲーションのテスト
  - [x] レスポンシブデザインのテスト
- [x] ダッシュボードレイアウト
- [x] 学習メニュー表示
- [x] 成績サマリー表示（簡易版）
- [x] クイズ開始ボタン
- [x] **テスト実行**: `npm test`
- [x] **コミット**: `git add . && git commit -m "[ホーム画面]: ダッシュボードとナビゲーション実装"`

### 1.6 基本クイズシステム ✅
- [x] **テスト作成**: クイズシステムのテスト
  - [x] 問題表示のテスト
  - [x] 回答処理のテスト
  - [x] スコア計算のテスト
  - [x] 問題遷移のテスト
- [x] 問題データの取得API
  - [x] ランダム問題取得
  - [x] 問題詳細取得
- [x] クイズ画面UI
  - [x] 画像表示コンポーネント
  - [x] 回答入力フィールド
  - [x] 制限時間表示（オプション）
  - [x] 進捗表示
- [x] 回答判定ロジック
  - [x] 正解判定（完全一致）
  - [x] 部分一致対応
  - [x] 表記ゆれ対応
- [x] 結果画面
  - [x] 正解/不正解表示
  - [x] 正解の表示
  - [x] 次の問題へのナビゲーション
- [x] **テスト実行**: `npm test`
- [x] **コミット**: `git add . && git commit -m "[基本クイズ]: 問題表示と回答処理機能実装"`

### 1.7 回答履歴の記録
- [x] **テスト作成**: 回答履歴機能のテスト
  - [x] 回答記録APIのテスト
  - [x] 履歴データ取得のテスト
  - [x] 成績計算のテスト
- [x] UserAnswers テーブルへの保存
- [x] 回答統計の計算
- [x] 簡単な成績表示
- [x] **テスト実行**: `npm test`
- [x] **コミット**: `git add . && git commit -m "[回答履歴]: 回答記録と基本成績表示機能実装"`

## Phase 2: 学習支援機能

### 2.1 復習システム
- [ ] **テスト作成**: 復習システムのテスト
  - [ ] 間違えた問題抽出のテスト
  - [ ] 復習モードのテスト
  - [ ] 優先度付けロジックのテスト
- [ ] 間違えた問題の抽出ロジック
- [ ] 復習専用クイズモード
- [ ] 正解率による優先度付け
- [ ] 復習画面UI
  - [ ] 間違えた問題一覧
  - [ ] フィルタリング機能
- [ ] **テスト実行**: `npm test`
- [ ] **コミット**: `git add . && git commit -m "[復習システム]: 間違えた問題の復習機能実装"`

### 2.2 詳細な成績分析
- [ ] **テスト作成**: 成績分析機能のテスト
  - [ ] グラフ表示のテスト
  - [ ] 統計計算のテスト
  - [ ] 成績データ取得のテスト
- [ ] 成績画面の拡張
  - [ ] 正解率推移グラフ
  - [ ] 分野別成績分析
  - [ ] 学習時間記録
  - [ ] 難易度別成績
- [ ] 統計データの計算API
- [ ] グラフ表示ライブラリの導入
- [ ] **テスト実行**: `npm test`
- [ ] **コミット**: `git add . && git commit -m "[成績分析]: 詳細な成績可視化と統計機能実装"`

### 2.3 問題絞り込み機能
- [ ] **テスト作成**: 問題絞り込み機能のテスト
  - [ ] フィルタリングロジックのテスト
  - [ ] 設定保存・読み込みのテスト
  - [ ] カスタム試験生成のテスト
- [ ] 設定画面の実装
  - [ ] 出題範囲選択（科・属別）
  - [ ] 難易度設定
  - [ ] 問題数設定
- [ ] フィルタリングロジック
- [ ] カスタム試験生成機能
- [ ] **テスト実行**: `npm test`
- [ ] **コミット**: `git add . && git commit -m "[問題絞り込み]: カスタム試験設定と絞り込み機能実装"`

### 2.4 画像最適化
- [ ] **テスト作成**: 画像最適化機能のテスト
  - [ ] 遅延読み込みのテスト
  - [ ] レスポンシブ画像のテスト
  - [ ] キャッシュ機能のテスト
- [ ] 画像の遅延読み込み
- [ ] レスポンシブ画像対応
- [ ] 画像キャッシュ戦略
- [ ] **テスト実行**: `npm test`
- [ ] **コミット**: `git add . && git commit -m "[画像最適化]: 遅延読み込みとレスポンシブ対応実装"`

## Phase 3: コミュニティ機能

### 3.1 コメント機能
- [ ] **テスト作成**: コメント機能のテスト
  - [ ] コメント投稿のテスト
  - [ ] コメント表示のテスト
  - [ ] コメント管理のテスト
- [ ] コメント投稿UI
  - [ ] 問題別コメント表示
  - [ ] コメント投稿フォーム
  - [ ] コメント編集・削除
- [ ] コメント管理API
  - [ ] 投稿・取得・更新・削除
  - [ ] ページネーション
- [ ] 返信機能
  - [ ] ネストしたコメント表示
  - [ ] 返信投稿機能
- [ ] **テスト実行**: `npm test`
- [ ] **コミット**: `git add . && git commit -m "[コメント機能]: 問題へのコメント投稿・表示機能実装"`

### 3.2 評価機能
- [ ] **テスト作成**: 評価機能のテスト
  - [ ] 問題評価のテスト
  - [ ] 評価集計のテスト
  - [ ] いいね機能のテスト
- [ ] 問題評価システム
  - [ ] いいね・だめだねボタン
  - [ ] 評価の集計・表示
  - [ ] 重複評価の防止
- [ ] コメント評価システム
  - [ ] コメントへのいいね・だめだね
  - [ ] 評価数の表示
- [ ] **テスト実行**: `npm test`
- [ ] **コミット**: `git add . && git commit -m "[評価機能]: 問題・コメント評価システム実装"`

### 3.3 ユーザー間交流
- [ ] **テスト作成**: ユーザー間交流機能のテスト
  - [ ] プロフィール表示のテスト
  - [ ] ランキング機能のテスト
  - [ ] 交流機能のテスト
- [ ] ユーザープロフィール拡張
  - [ ] 学習統計の公開設定
  - [ ] アバター設定
- [ ] ランキング機能
  - [ ] 正解率ランキング
  - [ ] 学習時間ランキング
  - [ ] 月間・週間ランキング
- [ ] **テスト実行**: `npm test`
- [ ] **コミット**: `git add . && git commit -m "[ユーザー交流]: プロフィール公開とランキング機能実装"`

## Phase 4: 拡張機能（将来実装）

### 4.1 掲示板機能
- [ ] **テスト作成**: 掲示板機能のテスト
  - [ ] 掲示板システム設計のテスト
  - [ ] トピック作成・管理のテスト
  - [ ] カテゴリ分類のテスト
- [ ] 掲示板システム設計
- [ ] トピック作成・管理
- [ ] カテゴリ分類
- [ ] モデレーション機能
- [ ] **テスト実行**: `npm test`
- [ ] **コミット**: `git add . && git commit -m "[掲示板機能]: 掲示板システムとモデレーション機能実装"`

### 4.2 プレミアム機能
- [ ] **テスト作成**: プレミアム機能のテスト
  - [ ] 課金システムのテスト
  - [ ] Stripe連携のテスト
  - [ ] プレミアム限定機能のテスト
- [ ] 課金システム設計
- [ ] Stripe 連携
- [ ] プレミアム限定機能
  - [ ] 詳細統計
  - [ ] 高画質画像
  - [ ] 優先サポート
- [ ] **テスト実行**: `npm test`
- [ ] **コミット**: `git add . && git commit -m "[プレミアム機能]: 課金システムとプレミアム限定機能実装"`

### 4.3 PWA対応
- [ ] **テスト作成**: PWA機能のテスト
  - [ ] Service Workerのテスト
  - [ ] オフライン機能のテスト
  - [ ] プッシュ通知のテスト
- [ ] Service Worker 実装
- [ ] オフライン対応
- [ ] プッシュ通知
- [ ] アプリインストール対応
- [ ] **テスト実行**: `npm test`
- [ ] **コミット**: `git add . && git commit -m "[PWA対応]: Service WorkerとオフラインPWA機能実装"`

### 4.4 管理機能
- [ ] **テスト作成**: 管理機能のテスト
  - [ ] 管理者ダッシュボードのテスト
  - [ ] 問題・画像管理のテスト
  - [ ] ユーザー管理のテスト
- [ ] 管理者ダッシュボード
- [ ] 問題・画像管理
- [ ] ユーザー管理
- [ ] 統計・分析機能
- [ ] **テスト実行**: `npm test`
- [ ] **コミット**: `git add . && git commit -m "[管理機能]: 管理者ダッシュボードと統計分析機能実装"`

## データ準備タスク

### データ収集・整理
- [ ] **テスト作成**: データ準備のテスト
  - [ ] データ投入処理のテスト
  - [ ] データ品質チェックのテスト
  - [ ] 問題生成ロジックのテスト
- [ ] 野鳥リストの作成
- [ ] 画像収集（iNaturalist, Wikipedia等）
- [ ] ライセンス確認・記録
- [ ] 画像の品質チェック
- [ ] データベースへの投入
- [ ] 初期問題セットの作成
- [ ] **テスト実行**: `npm test`
- [ ] **コミット**: `git add . && git commit -m "[データ準備]: 野鳥データと初期問題セット投入完了"`

## テスト・品質保証

### テスト実装
- [ ] **テスト作成**: テスト環境のテスト
  - [ ] テスト設定の検証
  - [ ] CI/CDパイプラインのテスト
  - [ ] テストカバレッジの確認
- [ ] 単体テスト（Jest）
- [ ] 統合テスト
- [ ] E2Eテスト（Playwright）
- [ ] パフォーマンステスト
- [ ] **テスト実行**: `npm test`
- [ ] **コミット**: `git add . && git commit -m "[テスト実装]: 包括的テストスイート構築完了"`

### 品質保証
- [ ] **テスト作成**: 品質保証プロセスのテスト
  - [ ] セキュリティ監査のテスト
  - [ ] アクセシビリティテスト
  - [ ] コード品質チェックのテスト
- [ ] コードレビュー体制
- [ ] CI/CD パイプライン
- [ ] セキュリティ監査
- [ ] アクセシビリティ対応
- [ ] **テスト実行**: `npm test`
- [ ] **コミット**: `git add . && git commit -m "[品質保証]: セキュリティとアクセシビリティ対応完了"`

## デプロイ・運用

### デプロイメント
- [ ] **テスト作成**: デプロイメントのテスト
  - [ ] デプロイプロセスのテスト
  - [ ] 環境設定の検証
  - [ ] SSL証明書の確認
- [ ] Vercel デプロイ設定
- [ ] 環境変数設定
- [ ] ドメイン設定
- [ ] SSL証明書設定
- [ ] **テスト実行**: `npm test`
- [ ] **コミット**: `git add . && git commit -m "[デプロイメント]: 本番環境デプロイ設定完了"`

### 監視・運用
- [ ] **テスト作成**: 監視・運用のテスト
  - [ ] エラー監視設定のテスト
  - [ ] パフォーマンス監視のテスト
  - [ ] バックアップ機能のテスト
- [ ] エラー監視（Sentry）
- [ ] パフォーマンス監視
- [ ] ログ管理
- [ ] バックアップ戦略
- [ ] **テスト実行**: `npm test`
- [ ] **コミット**: `git add . && git commit -m "[監視・運用]: エラー監視とバックアップ戦略実装完了"`

## 実装優先度

### 最優先（Phase 1）
1. プロジェクトセットアップ ✅
2. Supabase セットアップ
3. 認証システム
4. 基本クイズシステム
5. 回答履歴記録

### 高優先（Phase 2）
1. 復習システム
2. 詳細成績分析
3. 問題絞り込み機能

### 中優先（Phase 3）
1. コメント機能
2. 評価機能
3. ランキング機能

### 低優先（Phase 4）
1. 掲示板機能
2. プレミアム機能
3. PWA対応

## 注意事項

### テストドリブン開発の徹底
- **Red-Green-Refactor**: 失敗するテスト → 実装 → リファクタリングのサイクル
- **テストファースト**: 機能実装前に必ずテストを作成
- **継続的テスト**: 各コミット前に全テストが通ることを確認
- **テストカバレッジ**: 最低80%のカバレッジを維持

### 技術的考慮事項
- レスポンシブデザイン必須
- SEO対策（メタタグ、構造化データ）
- パフォーマンス最適化
- セキュリティ対策（XSS、CSRF等）

### データ関連
- 著作権に配慮した画像使用
- 野鳥データの正確性確保
- 定期的なデータ更新

### ユーザビリティ
- 直感的なUI/UX
- アクセシビリティ対応
- 多デバイス対応

### 開発プロセス
- 各フェーズの完了後に動作確認とテストを実施
- データベース設計の変更は早期に実施
- セキュリティ対策は各フェーズで継続的に実装
- ユーザビリティテストを定期的に実施
- パフォーマンス最適化は継続的に実施

---

**開発開始**: 各タスクは必ずテスト作成から開始し、テスト実行とコミットで完了させること。